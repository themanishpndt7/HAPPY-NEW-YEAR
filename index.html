<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to 2026 | New Year Wishes & Dreams | Our Beautiful Journey Ahead</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Caveat:wght@400;700&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #ff6b9d;
            --secondary: #ffa500;
            --accent: #ffcc00;
            --dark: #4a235a;
            --light: #fff5f7;
            --gradient: linear-gradient(135deg, #ff6b9d 0%, #ffa500 100%);
            --gradient-dark: linear-gradient(135deg, #4a235a 0%, #8e44ad 100%);
            --shadow: 0 10px 30px rgba(255, 107, 157, 0.2);
            --shadow-dark: 0 10px 30px rgba(74, 35, 90, 0.3);
        }
        
        /* 3D Canvas Background */
        #canvas-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
            opacity: 0.05;
            pointer-events: none;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom, var(--light), #ffebf2);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: var(--gradient-dark);
            color: white;
            padding: 20px 0;
            box-shadow: var(--shadow-dark);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid var(--accent);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }
        
        .logo i {
            color: var(--accent);
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.2); }
            50% { transform: scale(1); }
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1rem;
            padding: 8px 15px;
            border-radius: 30px;
            transition: all 0.3s ease;
            position: relative;
            display: block;
        }
        
        nav a:hover, nav a.active {
            background-color: rgba(255, 204, 0, 0.2);
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background-color: var(--accent);
            transition: width 0.3s ease;
        }
        
        nav a:hover::after, nav a.active::after {
            width: 70%;
        }
        
        .mobile-toggle {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            color: white;
            z-index: 1001;
        }
        
        main {
            padding: 40px 0;
            min-height: calc(100vh - 200px);
            position: relative;
            z-index: 20;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.8s ease-out;
            position: relative;
            z-index: 1;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hero {
            text-align: center;
            padding: 60px 20px;
            background: var(--gradient);
            border-radius: 20px;
            color: white;
            margin-bottom: 50px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .hero h1 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2rem, 8vw, 4rem);
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }
        
        .btn {
            display: inline-block;
            padding: 15px 35px;
            background-color: white;
            color: var(--primary);
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin: 10px 5px;
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            background-color: var(--accent);
            color: white;
        }
        
        .wishes-container,
        .memories-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .wish-card,
        .memory-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: all 0.4s ease;
            position: relative;
            border: 2px solid transparent;
            overflow: hidden;
        }
        
        .wish-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(255, 107, 157, 0.3);
            border-color: var(--primary);
        }
        
        .wish-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient);
        }
        
        .wish-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .wish-card h3,
        .memory-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .wish-card p,
        .memory-card p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .memory-img {
            height: 200px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            border-radius: 15px 15px 0 0;
            margin: -30px -30px 20px -30px;
        }
        
        .letter-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            max-width: 900px;
            margin: 40px auto;
            position: relative;
            border: 2px dashed var(--secondary);
        }
        
        .letter-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .letter-header h2 {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2rem, 6vw, 3rem);
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .letter-date {
            color: var(--dark);
            font-style: italic;
        }
        
        .letter-body {
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .letter-body p {
            margin-bottom: 25px;
        }
        
        .letter-signature {
            text-align: right;
            margin-top: 40px;
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            color: var(--primary);
        }
        
        .countdown-container {
            text-align: center;
            padding: 50px 20px;
        }
        
        .countdown-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2rem, 6vw, 3rem);
            color: var(--primary);
            margin-bottom: 30px;
        }
        
        .countdown-box {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .countdown-item {
            background: white;
            border-radius: 15px;
            padding: 30px 20px;
            min-width: 100px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        
        .countdown-item:hover {
            transform: translateY(-10px);
            background: var(--gradient);
            color: white;
        }
        
        .countdown-item:hover .countdown-number,
        .countdown-item:hover .countdown-label {
            color: white;
        }
        
        .countdown-number {
            font-size: clamp(1.5rem, 5vw, 3rem);
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .countdown-label {
            font-size: 1rem;
            color: var(--dark);
            font-weight: 500;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        footer {
            background: var(--gradient-dark);
            color: white;
            padding: 60px 0 30px;
            margin-top: 80px;
            position: relative;
            z-index: 10;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-section h3 {
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--accent);
        }
        
        .footer-section p {
            opacity: 0.9;
            margin-bottom: 20px;
            line-height: 1.7;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 12px;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .footer-links a:hover {
            color: var(--accent);
            padding-left: 10px;
        }
        
        .heart-counter {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }
        
        .heart-counter span {
            font-size: 2rem;
            color: var(--accent);
            font-weight: bold;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .social-icons a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0);
        }
        
        .social-icons a:hover {
            background: var(--accent);
            transform: translateY(-5px);
            border-color: white;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .footer-bottom span {
            color: var(--accent);
            font-weight: bold;
        }
        
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .heart {
            position: absolute;
            color: rgba(255, 107, 157, 0.3);
            font-size: clamp(10px, 2vw, 20px);
            animation: float 20s infinite linear;
            opacity: 0.4;
            pointer-events: none;
        }
        
        @keyframes float {
            0% { bottom: -50px; opacity: 1; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { bottom: 100vh; opacity: 0; }
        }
        
        /* Music Player */
        .music-player {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 60;
            background: rgba(74, 35, 90, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid var(--accent);
            border-radius: 50px;
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .music-player:hover {
            background: rgba(74, 35, 90, 0.95);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.4);
        }
        
        .music-bars {
            display: flex;
            gap: 3px;
            align-items: flex-end;
            height: 20px;
        }
        
        .bar {
            width: 3px;
            background: var(--primary);
            animation: equalizer 0.6s ease-in-out infinite;
        }
        
        .bar:nth-child(2) { animation-delay: 0.1s; }
        .bar:nth-child(3) { animation-delay: 0.2s; }
        
        .music-player.paused .bar {
            animation: none;
            height: 3px;
        }
        
        @keyframes equalizer {
            0%, 100% { height: 5px; }
            50% { height: 20px; }
        }
        
        /* Coupon Cards */
        .coupon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .coupon {
            background: white;
            border: 3px dashed var(--primary);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .coupon:hover:not(.redeemed) {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(255, 107, 157, 0.3);
            border-color: var(--secondary);
        }
        
        .coupon.redeemed {
            opacity: 0.5;
            border-color: #ccc;
            background: #f5f5f5;
        }
        
        .coupon h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .coupon p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* Timeline */
        .timeline {
            position: relative;
            max-width: 800px;
            margin: 40px auto;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 100%;
            background: var(--gradient);
        }
        
        .timeline-item {
            margin-bottom: 30px;
            position: relative;
        }
        
        .timeline-item:nth-child(odd) .timeline-content {
            margin-left: 0;
            margin-right: auto;
            width: calc(50% - 30px);
            text-align: right;
        }
        
        .timeline-item:nth-child(even) .timeline-content {
            margin-left: auto;
            margin-right: 0;
            width: calc(50% - 30px);
            text-align: left;
        }
        
        .timeline-dot {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: var(--primary);
            border: 4px solid white;
            border-radius: 50%;
            top: 0;
            box-shadow: 0 0 0 4px var(--gradient);
        }
        
        .timeline-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .timeline-content h3 {
            color: var(--primary);
            margin: 0 0 10px 0;
        }
        
        .timeline-content p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .timeline-item.highlight .timeline-content {
            border: 2px solid var(--primary);
            box-shadow: 0 8px 30px rgba(139,0,139,0.12);
            background: linear-gradient(180deg, #fff6fb 0%, #fff 100%);
        }
        
        /* Heart Button */
        .heart-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 60;
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.3);
            transition: all 0.3s ease;
            position: relative;
            border: none;
        }
        
        .heart-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.5);
        }
        
        .heart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--accent);
            color: var(--dark);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        /* Mood Tracker Styles */
        .mood-btn {
            padding: 15px 10px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .mood-btn:hover {
            background: var(--gradient);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }
        
        .mood-btn.selected {
            background: var(--primary);
            color: white;
        }
        
        /* Neon Input for forms */
        .neon-input {
            padding: 12px 15px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .neon-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }
        
        @media (max-width: 1024px) {
            .wishes-container,
            .memories-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }
            
            nav {
                position: absolute;
                top: 70px;
                left: 0;
                right: 0;
                background: var(--gradient-dark);
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }
            
            nav.active {
                max-height: 500px;
            }
            
            nav ul {
                flex-direction: column;
                gap: 0;
            }
            
            nav a {
                padding: 15px 20px;
                border-radius: 0;
            }
            
            .wishes-container,
            .memories-container {
                grid-template-columns: 1fr;
            }
            
            .countdown-box {
                gap: 10px;
            }
            
            .countdown-item {
                min-width: 70px;
                padding: 15px 10px;
            }
            
            .letter-container {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .countdown-box {
                display: grid;
                grid-template-columns: 1fr 1fr;
            }
            
            .countdown-item {
                min-width: 60px;
                padding: 12px 8px;
            }
            
            .wish-card,
            .memory-card {
                padding: 20px;
            }
            
            nav a {
                font-size: 0.9rem;
            }
            
            .hero {
                min-height: 350px;
                padding: 30px 15px;
            }
        }
    </style>
</head>

<body>
    <!-- 3D Canvas Background -->
    <canvas id="canvas-bg"></canvas>
    
    <!-- Floating Hearts Background -->
    <div class="floating-hearts" id="heartsContainer"></div>
    
    <!-- Music Player -->
    <div class="music-player paused" id="musicPlayer">
        <div class="music-bars">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <span id="musicText">Play Music</span>
    </div>
    
    <!-- Love Button -->
    <button class="heart-btn" id="heartBtn" onclick="sendLove()">
        <i class="fas fa-heart text-white text-2xl"></i>
        <span class="heart-count" id="heartCount">0</span>
    </button>
    
    <!-- Modal for messages -->
    <div id="messageModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; padding: 30px; border-radius: 20px; max-width: 400px; text-align: center; box-shadow: var(--shadow); position: relative;">
            <h3 id="modalTitle" style="color: var(--primary); margin-bottom: 15px;"></h3>
            <p id="modalMessage"></p>
            <button class="btn" onclick="closeModal()" style="margin-top: 20px;">Close</button>
        </div>
    </div>
    
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-heart heartbeat"></i>
                    <span>Welcome to 2026</span>
                </div>
                
                <div class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </div>
                
                <nav id="mainNav">
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="wishes">My Wishes</a></li>
                        <!-- Relationship Summary removed; content merged into other tabs -->
                        <li><a href="#" class="nav-link" data-page="memories">2026 Vision</a></li>
                        <li><a href="#" class="nav-link" data-page="letter">New Year Letter</a></li>
                        <li><a href="#" class="nav-link" data-page="countdown">Countdown</a></li>
                        <li><a href="#" class="nav-link" data-page="secret">Special Plans</a></li>
                        <li><a href="#" class="nav-link" data-page="timeline">Timeline</a></li>
                        <li><a href="#" class="nav-link" data-page="poetry">Hindi Poetry</a></li>
                        <li><a href="#" class="nav-link" data-page="interactive">Interactive</a></li>
                        <li><a href="#" class="nav-link" data-page="future">Vision Board</a></li>
                        <li><a href="#" class="nav-link" data-page="coupons">Love Coupons</a></li>
                        <li><a href="#" class="nav-link" data-page="music">Music Player</a></li>
                        <li><a href="#" class="nav-link" data-page="gallery">Photo Gallery</a></li>
                        <li><a href="#" class="nav-link" data-page="mood">Mood Tracker</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Home Page -->
        <section id="home" class="page active">
            <div class="hero">
                <h1>Welcome to 2026</h1>
                <div style="font-size: 2.5rem; margin-bottom: 15px;">üéâ A Year of Dreams & New Beginnings üéâ</div>
                <p><strong>Let's Make This Year Extraordinary Together</strong></p>
                <div style="font-size: 1.1rem; margin-bottom: 20px; margin-top: 15px;">
                    <span style="display: block; margin: 8px 0;">‚ú® January 1, 2026 - A Fresh Start ‚ú®</span>
                    <span style="display: block; font-style: italic;">Every moment is an opportunity for something beautiful</span>
                </div>
                <button class="btn" style="background: white; color: #ff6b9d;">
                    <i class="fas fa-star"></i> Begin Our Journey
                </button>
            </div>
            
            <div class="wishes-container" style="text-align: center;">
                <div class="wish-card" style="background: linear-gradient(135deg, #fff5f7 0%, #ffebf2 100%); border: 2px solid #ff6b9d;">
                    <h3 style="color: #ff6b9d;">Together We Rise</h3>
                </div>
            </div>

            

            <div class="page-header">
                <h1 class="countdown-title">üì∏ Our Memory Gallery üì∏</h1>
            </div>
            <div style="padding: 30px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <p style="color: #666;">You can open the full gallery to upload and view photos.</p>
                </div>
                <div style="text-align:center; margin: 10px 0 20px;">
                    <p style="color:#666;">Visit the full gallery to view and upload photos.</p>
                    <button class="btn" onclick="document.querySelector('.nav-link[data-page=gallery]').click()">Open Gallery</button>
                </div>
                
                <!-- Lightbox Modal -->
                <div id="lightbox" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1500; justify-content: center; align-items: center;" onclick="closeLightbox()">
                    <img id="lightboxImg" style="max-width: 90%; max-height: 90%; border-radius: 10px;">
                    <button onclick="closeLightbox()" style="position: absolute; top: 20px; right: 20px; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.5rem; cursor: pointer; z-index: 1501;">√ó</button>
                </div>
            </div>
        </section>

            <!-- Wishes Page -->
            <section id="wishes" class="page" style="display:none;">
                <div class="page-header">
                    <h1 class="countdown-title">‚ú® My Wishes</h1>
                    <p style="color:#666;">Add small wishes and dreams for 2026</p>
                </div>
                <div style="max-width:800px; margin:0 auto; padding:20px;">
                    <div style="display:flex; gap:10px; margin-bottom:12px; align-items:center;">
                        <input id="wishTitle" class="neon-input" placeholder="Wish title (e.g., Picnic Together)" style="flex:2">
                        <input id="wishDesc" class="neon-input" placeholder="Short note (optional)" style="flex:3">
                        <button class="btn" onclick="addWish()">Add Wish</button>
                    </div>
                    <div id="wishesList" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:16px;"></div>
                </div>
            </section>

            <!-- Timeline Page -->
            <section id="timeline" class="page">
                <div class="page-header">
                    <h1 class="countdown-title">üóìÔ∏è Our Journey Timeline (20 Meetings)</h1>
                </div>
                <div style="max-width: 900px; margin: 0 auto;">
                    <div style="display:flex; gap:10px; margin-bottom:20px; align-items:center;">
                        <input id="eventTitle" class="neon-input" placeholder="Event title (e.g., Meeting #1 or Her Birthday)" style="flex:2">
                        <input id="eventDate" class="neon-input" type="date" style="flex:1">
                        <input id="eventNote" class="neon-input" placeholder="Short note" style="flex:3">
                        <button class="btn" onclick="addTimelineEvent()">Add</button>
                    </div>

                    <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                        <button class="btn" onclick="backupTimeline()">Export Timeline</button>
                        <button class="btn" onclick="resetTimeline()">Reset Timeline</button>
                        <button class="btn" onclick="restoreTimeline()">Restore Last Backup</button>
                        <div style="margin-left:auto; color:#666; font-size:0.95rem;">Total events: <span id="timelineCount">0</span></div>
                    </div>

                    <div id="timelineList" class="timeline"></div>
                </div>
            </section>

            <!-- Poetry Page -->
            <section id="poetry" class="page" style="display:none;">
                <div class="page-header">
                    <h1 class="countdown-title">üìù Hindi Poetry</h1>
                    <p style="color:#666;">Share a short line or shayari</p>
                </div>
                <div style="padding: 20px; max-width:800px; margin:0 auto;">
                    <div style="display:flex; gap:10px; margin-bottom:12px; align-items:center;">
                        <input id="poemInput" class="neon-input" placeholder="Write a short line..." style="flex:1">
                        <button class="btn" onclick="addPoem()">Add</button>
                    </div>
                    <div id="poemsList" style="background: rgba(255,255,255,0.9); padding:16px; border-radius:12px;"></div>
                </div>
            </section>

            <!-- Interactive Page -->
            <section id="interactive" class="page" style="display:none;">
                <div class="page-header">
                    <h1 class="countdown-title">üéÆ Interactive</h1>
                    <p style="color:#666;">Games & little surprises</p>
                </div>
                <div style="padding:20px; max-width:900px; margin:0 auto; text-align:center;">
                    <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-bottom:18px;">
                        <button class="btn" onclick="startMemoryGame()">Memory Game</button>
                        <button class="btn" onclick="startSongGuess()">Song Guess</button>
                        <button class="btn" onclick="startDateNightPicker()">Date Night Picker</button>
                        <button class="btn" onclick="startFortuneTeller()">Fortune Teller</button>
                        <button class="btn" onclick="closeGame()">Close</button>
                    </div>
                    <div id="gameArea" style="display:none; background:white; padding:18px; border-radius:12px; box-shadow:var(--shadow);">
                        <div id="gameContent"></div>
                    </div>
                </div>
            </section>

        <!-- Mood Tracker Page -->
        <section id="mood" class="page">
            <div class="page-header">
                <h1 class="countdown-title">üòä Mood Tracker üòä</h1>
            </div>
            <div style="padding: 30px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <p style="font-size: 1.1rem; color: #666; margin-bottom: 20px;">How are you feeling today?</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; max-width: 600px; margin: 0 auto;">
                        <button class="mood-btn" data-mood="happy" onclick="trackMood('happy')">üòä Happy</button>
                        <button class="mood-btn" data-mood="loved" onclick="trackMood('loved')">üíï Loved</button>
                        <button class="mood-btn" data-mood="excited" onclick="trackMood('excited')">ü§© Excited</button>
                        <button class="mood-btn" data-mood="peaceful" onclick="trackMood('peaceful')">üòå Peaceful</button>
                        <button class="mood-btn" data-mood="grateful" onclick="trackMood('grateful')">üôè Grateful</button>
                        <button class="mood-btn" data-mood="tired" onclick="trackMood('tired')">üò¥ Tired</button>
                    </div>
                </div>
                
                <div id="moodHistory" style="background: white; border-radius: 20px; padding: 30px; box-shadow: var(--shadow);">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Your Mood Journey</h3>
                    <div id="moodStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 20px;">
                        <!-- Mood stats will be populated here -->
                    </div>
                    <div id="recentMoods" style="max-height: 300px; overflow-y: auto;">
                        <!-- Recent moods will be shown here -->
                    </div>
                </div>
            </div>
        </section>
        
        
        <!-- 2026 Vision Page -->
        <section id="memories" class="page">
            <div class="page-header">
                <h1 class="countdown-title">üéØ My 2026 Vision Board üéØ</h1>
                <p style="color: #666; max-width: 800px; margin: 0 auto;">Dreams to make reality</p>
            </div>
            <div class="memories-container">
                <div class="memory-card"><div class="memory-img">üìö</div><h3>Learn Something New</h3><p><strong>Q1 2026</strong> - A skill that excites me</p></div>
                <div class="memory-card"><div class="memory-img">‚úàÔ∏è</div><h3>Dream Destination</h3><p><strong>Q2 2026</strong> - Somewhere magical awaits</p></div>
                <div class="memory-card"><div class="memory-img">üí™</div><h3>Get Healthier</h3><p><strong>Q1-Q4 2026</strong> - Wellness goals achieved</p></div>
                <div class="memory-card" style="border: 2px solid var(--accent);"><div class="memory-img" style="background: linear-gradient(135deg, #8e44ad 0%, #a569bd 100%);">üíº</div><h3 style="color: var(--primary);">Career Success</h3><p style="color: var(--primary);"><strong>Throughout 2026</strong></p></div>
                <div class="memory-card"><div class="memory-img">üé®</div><h3>Creative Pursuits</h3><p><strong>Q2-Q3 2026</strong> - Express myself freely</p></div>
                <div class="memory-card"><div class="memory-img">‚ù§Ô∏è</div><h3>Strengthen Bonds</h3><p><strong>Year-Round</strong> - Quality time with loved ones</p></div>
                <div class="memory-card"><div class="memory-img">üåü</div><h3>Give Back</h3><p><strong>Q3-Q4 2026</strong> - Help others, make impact</p></div>
                <div class="memory-card" style="border: 2px solid var(--accent);"><div class="memory-img" style="background: linear-gradient(135deg, #8e44ad 0%, #a569bd 100%);">üíç</div><h3 style="color: var(--primary);">Us Together</h3><p style="color: var(--primary);"><strong>Forever</strong> - The Greatest Goal!</p></div>
                <div class="memory-card"><div class="memory-img">üéâ</div><h3>Celebrate Life</h3><p><strong>Every Day</strong> - Find joy in everything</p></div>
                <div class="memory-card"><div class="memory-img">üìñ</div><h3>Read & Learn</h3><p><strong>Throughout</strong> - Expand my mind</p></div>
                <div class="memory-card"><div class="memory-img">üèÉ</div><h3>Adventure Awaits</h3><p><strong>Q2-Q4 2026</strong> - Try something daring</p></div>
                <div class="memory-card"><div class="memory-img">üåà</div><h3>Be Happy</h3><p><strong>Every Day</strong> - Spread positivity</p></div>
                
                <div style="width:100%; margin-top:20px; background: rgba(255,255,255,0.9); border-radius:12px; padding:16px;">
                    <h3 style="margin-top:0; color:var(--primary);">Memory Jar</h3>
                    <div id="memoryJar" style="color: #333;"></div>
                </div>
            </div>
        </section>
        
        <!-- Vision Board (separate editable board) -->
        <section id="future" class="page">
            <div class="page-header">
                <h1 class="countdown-title">üñºÔ∏è Vision Board</h1>
                <p style="color: #666; max-width: 800px; margin: 0 auto;">Create visual goals by adding images or notes to the board.</p>
            </div>

            <div style="max-width: 1000px; margin: 20px auto; padding: 20px;">
                <div style="display:flex; gap:10px; align-items:center; margin-bottom:20px;">
                    <input type="file" id="visionUpload" accept="image/*" onchange="addVisionItemFromFile(this)">
                    <input id="visionText" class="neon-input" placeholder="Add a vision note (e.g., Travel to Bali)">
                    <button class="btn" onclick="addVisionText()">Add Note</button>
                </div>

                <div id="visionGrid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:20px;"></div>
            </div>
        </section>

        <!-- New Year Letter Page -->
        <section id="letter" class="page">
            <div class="letter-container">
                <div class="letter-header">
                    <h2>üíå A Letter for Our 2026</h2>
                    <div class="letter-date">December 31, 2025 - The Eve of New Beginnings</div>
                </div>
                
                <div class="letter-body">
                    <p>As we stand on the threshold of 2026, I want to take a moment to tell you how grateful I am. For your love, your presence, and your commitment to us and our journey together.</p>
                    
                    <p>2025 has been beautiful, and 2026 promises to be even more extraordinary. Together, we have the power to make dreams come true, to overcome any challenge, and to build the life we've always imagined.</p>
                    
                    <h3 style="color: var(--primary); margin-top: 25px; margin-bottom: 15px;">My Promises for 2026:</h3>
                    <div style="background: rgba(255, 107, 157, 0.05); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p>üíù <strong>To love you more deeply</strong> - With each passing day</p>
                        <p>üéØ <strong>To support your dreams</strong> - No matter how big or small</p>
                        <p>ü§ù <strong>To be your rock</strong> - Through every challenge and celebration</p>
                        <p>‚ú® <strong>To create beautiful memories</strong> - Every single day</p>
                        <p>üí™ <strong>To grow together</strong> - Becoming better versions of ourselves</p>
                        <p>üòä <strong>To make you smile</strong> - Every chance I get</p>
                        <p>üåü <strong>To chase our dreams</strong> - And turn them into reality</p>
                        <p>üíë <strong>To build our future</strong> - With passion and purpose</p>
                    </div>
                
                    <div id="letterExtras" style="margin-top:18px;"></div>

                    <div style="background: linear-gradient(135deg, var(--gradient)); padding: 20px; border-radius: 15px; color: white; margin-top: 30px;">
                        <h3 style="text-align: center; margin-top: 0; color: white;">My Promise for Our Future üíç</h3>
                        <p style="text-align: center; font-style: italic; margin-bottom: 0;">"2026 is the year we make dreams come true. The year our love grows stronger. The year we build memories that last a lifetime."</p>
                    </div>
                </div>
                
                <div class="letter-signature">Yours in 2026 and Beyond ‚ù§Ô∏è</div>
            </div>
        </section>
        
        <!-- Countdown Page -->
        <section id="countdown" class="page">
            <div class="countdown-container">
                <h1 class="countdown-title">The Countdown Has Begun!</h1>
                <p style="color: #666; max-width: 700px; margin: 0 auto 30px;">Every second brings us closer to 2026!</p>
                
                <div class="countdown-box">
                    <div class="countdown-item">
                        <div class="countdown-number" id="countdown-days">00</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="countdown-hours">00</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="countdown-minutes">00</div>
                        <div class="countdown-label">Minutes</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-number" id="countdown-seconds">00</div>
                        <div class="countdown-label">Seconds</div>
                    </div>
                </div>
                
                <p style="font-size: 1.2rem; color: var(--dark); max-width: 800px; margin: 40px auto;">
                    <i class="fas fa-heart" style="color: var(--primary); margin-right: 10px;"></i>
                    2026 is almost here! Let's welcome it with excitement, hope, and dreams!
                </p>
            </div>
        </section>
        
        <!-- Special Plans & Playlist Page -->
        <section id="secret" class="page">
            <div style="text-align: center; padding: 40px 20px;">
                <h1 class="countdown-title">üéâ 2026 Plans & Special Moments üéâ</h1>
                
                <div class="countdown-box" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px;">
                    <div class="wish-card" style="background: linear-gradient(135deg, #ff6b9d 0%, #ffa500 100%); color: white; border: none;">
                        <h3 style="color: white;">‚úàÔ∏è Adventure Trip</h3>
                        <p style="color: white; font-weight: bold;">Travel Together</p>
                    </div>
                    <div class="wish-card" style="background: linear-gradient(135deg, #ff6b9d 0%, #ffa500 100%); color: white; border: none;">
                        <h3 style="color: white;">üé¨ Movie Nights</h3>
                        <p style="color: white; font-weight: bold;">Weekly Dates</p>
                    </div>
                    <div class="wish-card" style="background: linear-gradient(135deg, #ff6b9d 0%, #ffa500 100%); color: white; border: none;">
                        <h3 style="color: white;">üçΩÔ∏è Cooking Together</h3>
                        <p style="color: white; font-weight: bold;">Learn New Recipes</p>
                    </div>
                    <div class="wish-card" style="background: linear-gradient(135deg, #ff6b9d 0%, #ffa500 100%); color: white; border: none;">
                        <h3 style="color: white;">üíë Date Nights</h3>
                        <p style="color: white; font-weight: bold;">Romantic Evenings</p>
                    </div>
                </div>
                
                <div style="margin-top: 50px; padding: 40px 20px; background: rgba(255, 107, 157, 0.1); border-radius: 20px;">
                    <h2 class="countdown-title">üíù Love Coupons üíù</h2>
                    <p style="color: #666; margin-bottom: 30px;">Click to redeem special moments!</p>
                    
                    <div style="text-align:center; color:#666;">Open the Love Coupons page to view and redeem coupons.</div>
                </div>
                
                <div style="margin-top: 50px; padding: 40px 20px; background: rgba(255, 107, 157, 0.1); border-radius: 20px;">
                    <h2 class="countdown-title">üéµ 2026 Feel-Good Playlist üéµ</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; text-align: left;">
                        <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--primary);">
                            <h3 style="color: var(--primary);">üíñ Hindi Party Songs</h3>
                            <p style="margin: 5px 0;">üéµ Badshah - Vande Mataram</p>
                            <p style="margin: 5px 0;">üéµ Arijit Singh - Gerua</p>
                            <p style="margin: 5px 0;">üéµ Yo Yo Honey Singh - Party With Bhagwa</p>
                            <p style="margin: 5px 0;">üéµ Neha Kakkar - Cheez Badi</p>
                            <p style="margin: 5px 0;">üéµ Ranveer Singh - Khalibali</p>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--primary);">
                            <h3 style="color: var(--primary);">üíñ English Pop Hits</h3>
                            <p style="margin: 5px 0;">üéµ Taylor Swift - Anti-Hero</p>
                            <p style="margin: 5px 0;">üéµ The Weeknd - Blinding Lights</p>
                            <p style="margin: 5px 0;">üéµ Dua Lipa - Levitating</p>
                            <p style="margin: 5px 0;">üéµ Olivia Rodrigo - drivers license</p>
                            <p style="margin: 5px 0;">üéµ Harry Styles - As It Was</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Love Coupons, Music Player, and Photo Gallery Pages -->
    <section id="coupons" class="page" style="display:none;">
        <div class="page-header">
            <h1 class="countdown-title">üíù Love Coupons</h1>
            <p style="color:#666;">Click a coupon to redeem a special moment.</p>
        </div>
        <div style="max-width:900px; margin:0 auto; padding:20px;">
            <div id="couponGrid" class="coupon-grid">
                <div class="coupon" onclick="redeemCoupon(this)">
                    <h3>‚ù§Ô∏è Free Hug</h3>
                    <p>Unlimited hugs, no questions asked!</p>
                </div>
                <div class="coupon" onclick="redeemCoupon(this)">
                    <h3>üçï Pizza Night</h3>
                    <p>Your choice of pizza & movie</p>
                </div>
                <div class="coupon" onclick="redeemCoupon(this)">
                    <h3>üíÜ Relaxation</h3>
                    <p>One full body massage session</p>
                </div>
                <div class="coupon" onclick="redeemCoupon(this)">
                    <h3>üéÅ Surprise Gift</h3>
                    <p>A mysterious gift awaits you</p>
                </div>
                <div class="coupon" onclick="redeemCoupon(this)">
                    <h3>üöó Adventure</h3>
                    <p>Road trip to anywhere you want</p>
                </div>
                <div class="coupon" onclick="redeemCoupon(this)">
                    <h3>üåô Stargazing</h3>
                    <p>Romantic night under the stars</p>
                </div>
            </div>
        </div>
    </section>

    <section id="music" class="page" style="display:none;">
        <div class="page-header">
            <h1 class="countdown-title">üéµ Music Player</h1>
            <p style="color:#666;">Upload a track or use the player below.</p>
        </div>
        <div style="max-width:900px; margin:0 auto; padding:20px; text-align:center;">
            <div style="margin-bottom:16px;">
                <input type="file" id="musicUpload" accept="audio/*" onchange="handleMusicUpload(this)">
            </div>
            <audio id="customMusic" controls style="width:100%; border-radius:12px; box-shadow:var(--shadow);">
                <source src="" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            <div style="margin-top:12px;">
                <button class="btn" onclick="document.getElementById('customMusic').play()">Play</button>
                <button class="btn" onclick="document.getElementById('customMusic').pause()">Pause</button>
            </div>
        </div>
    </section>

    <section id="gallery" class="page" style="display:none;">
        <div class="page-header">
            <h1 class="countdown-title">üì∏ Photo Gallery</h1>
            <p style="color:#666;">Upload photos to save into your memory gallery.</p>
        </div>
        <div style="max-width:1000px; margin:0 auto; padding:20px;">
            <div style="text-align:center; margin-bottom:18px;">
                <input type="file" id="photoUpload" accept="image/*" multiple onchange="handlePhotoUpload(this)" style="margin-bottom: 12px;">
            </div>
            <div id="photoGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Welcome to 2026</h3>
                    <p>A heartfelt collection of wishes, dreams, and promises dedicated to you. May 2026 be our most beautiful year yet.</p>
                    <div class="heart-counter">
                        <p>Wishes sent:</p>
                        <span id="heartCount">‚àû</span>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#" class="nav-link" data-page="home"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="#" class="nav-link" data-page="wishes"><i class="fas fa-heart"></i> Wishes</a></li>
                        <li><a href="#" class="nav-link" data-page="memories"><i class="fas fa-images"></i> Vision</a></li>
                        <li><a href="#" class="nav-link" data-page="letter"><i class="fas fa-envelope"></i> Letter</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>My Promise</h3>
                    <p>I promise to dream with you, celebrate with you, and create beautiful memories together throughout 2026.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fas fa-heart"></i></a>
                        <a href="#"><i class="fas fa-star"></i></a>
                        <a href="#"><i class="fas fa-gift"></i></a>
                        <a href="#"><i class="fas fa-music"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>Made with <i class="fas fa-heart" style="color: var(--accent);"></i> for 2026. &copy; 2025 - 2026 <span>Our New Year, Our Dreams</span></p>
            </div>
        </div>
    </footer>
    
    <script>
        // ========== UNIFIED JAVASCRIPT ==========
        
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        const mobileToggle = document.getElementById('mobileToggle');
        const mainNav = document.getElementById('mainNav');
        const heartsContainer = document.getElementById('heartsContainer');
        const musicPlayer = document.getElementById('musicPlayer');
        const musicText = document.getElementById('musicText');
        const heartBtn = document.getElementById('heartBtn');
        const heartCountEl = document.getElementById('heartCount');
        
        let heartCount = 0;
        let isPlayingMusic = false;
        let redeemedCoupons = new Set();
        
        // ========== 3D BACKGROUND WITH THREE.JS ==========
        function init3DBackground() {
            const canvas = document.getElementById('canvas-bg');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            camera.position.z = 30;
            
            // Create stars
            const starsGeometry = new THREE.BufferGeometry();
            const starCount = 2000;
            const positions = new Float32Array(starCount * 3);
            const colors = new Float32Array(starCount * 3);
            
            for(let i = 0; i < starCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 200;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 200;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 200;
                
                colors[i * 3] = Math.random();
                colors[i * 3 + 1] = Math.random();
                colors[i * 3 + 2] = Math.random();
            }
            
            starsGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            starsGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const starsMaterial = new THREE.PointsMaterial({
                size: 0.3,
                vertexColors: true,
                transparent: true,
                opacity: 0.7,
                sizeAttenuation: true
            });
            
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
            
            // Animation
            let animationFrameId;
            function animate() {
                animationFrameId = requestAnimationFrame(animate);
                stars.rotation.x += 0.0001;
                stars.rotation.y += 0.0002;
                renderer.render(scene, camera);
            }
            animate();
            
            // Handle resize
            window.addEventListener('resize', () => {
                renderer.setSize(window.innerWidth, window.innerHeight);
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            });
        }
        
        // Navigation System
        function setupNavigation() {
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetPage = this.getAttribute('data-page');
                    
                    // Remove active class from all links and pages
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    pages.forEach(page => {
                        page.classList.remove('active');
                        page.style.display = 'none'; // Ensure hidden
                    });
                    
                    // Add active class to clicked link and target page
                    this.classList.add('active');
                    const targetElement = document.getElementById(targetPage);
                    if (targetElement) {
                        targetElement.classList.add('active');
                        targetElement.style.display = 'block'; // Ensure visible
                    }
                    
                    if (mainNav.classList.contains('active')) {
                        mainNav.classList.remove('active');
                    }
                });
            });
            
            mobileToggle.addEventListener('click', () => {
                mainNav.classList.toggle('active');
            });
        }
        
        // Floating Hearts
        function createFloatingHearts() {
            if (!heartsContainer) return;
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = 'üíï';
                const size = Math.random() * 20 + 15;
                const left = Math.random() * 100;
                const duration = Math.random() * 10 + 15;
                const delay = Math.random() * 5;
                
                heart.style.cssText = `
                    position: absolute;
                    left: ${left}%;
                    bottom: -50px;
                    font-size: ${size}px;
                    opacity: 0.6;
                    pointer-events: none;
                    animation: float ${duration}s linear ${delay}s infinite;
                    z-index: 50;
                `;
                heartsContainer.appendChild(heart);
            }
        }
        
        // Countdown Timer
        function updateCountdown() {
            const target = new Date(2026, 0, 1).getTime();
            
            function update() {
                const now = new Date().getTime();
                const distance = target - now;
                
                if (distance > 0) {
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    
                    const updates = [
                        {id: 'days', value: days},
                        {id: 'hours', value: hours},
                        {id: 'minutes', value: minutes},
                        {id: 'seconds', value: seconds},
                        {id: 'countdown-days', value: days},
                        {id: 'countdown-hours', value: hours},
                        {id: 'countdown-minutes', value: minutes},
                        {id: 'countdown-seconds', value: seconds}
                    ];
                    
                    updates.forEach(el => {
                        const element = document.getElementById(el.id);
                        if (element) {
                            element.textContent = String(el.value).padStart(2, '0');
                        }
                    });
                }
            }
            
            update();
            setInterval(update, 1000);
        }
        
        // Music Player
        function setupMusicPlayer() {
            musicPlayer.addEventListener('click', toggleMusic);
        }
        
        function toggleMusic() {
            isPlayingMusic = !isPlayingMusic;
            if (isPlayingMusic) {
                musicPlayer.classList.remove('paused');
                musicText.textContent = 'Music Playing ‚ô´';
                const audio = document.getElementById('customMusic');
                try { if (audio && audio.pause && audio.play) { audio.play(); } } catch(e) { console.warn('audio play failed', e); }
            } else {
                musicPlayer.classList.add('paused');
                musicText.textContent = 'Play Music';
                const audio = document.getElementById('customMusic');
                try { if (audio && audio.pause) { audio.pause(); } } catch(e) { console.warn('audio pause failed', e); }
            }
        }
        
        // Heart/Love Button
        function sendLove() {
            heartCount++;
            heartCountEl.textContent = heartCount;
            
            // Create floating text effect
            const x = event.clientX;
            const y = event.clientY;
            const heart = document.createElement('div');
            heart.innerHTML = '‚ù§Ô∏è';
            heart.style.cssText = `
                position: fixed;
                left: ${x}px;
                top: ${y}px;
                font-size: 2rem;
                pointer-events: none;
                animation: float 3s ease-out forwards;
                z-index: 999;
            `;
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 3000);
            
            // Pulse effect
            heartBtn.style.transform = 'scale(1.2)';
            setTimeout(() => {
                heartBtn.style.transform = 'scale(1)';
            }, 200);
        }
        
        // Coupon Redeem
        function redeemCoupon(element) {
            if (!element.classList.contains('redeemed')) {
                element.classList.add('redeemed');
                
                // Save redeemed state
                const couponText = element.querySelector('h3').textContent;
                redeemedCoupons.add(couponText);
                localStorage.setItem('redeemedCoupons', JSON.stringify(Array.from(redeemedCoupons)));
                
                // Celebration effect
                createParticles(30);
            }
        }
        
        // Interactive Games
        // Couples Trivia removed per user request
        
        function startMemoryGame() {
            const cards = ['üíï', 'üåü', 'üéÅ', 'üçï', 'üé¨', 'üåô', 'üöó', 'üç¶'];
            const gameCards = [...cards, ...cards].sort(() => Math.random() - 0.5);
            let flippedCards = [];
            let matchedPairs = 0;
            
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <h3 style="color: var(--primary); margin-bottom: 20px;">Memory Game</h3>
                <p>Match the pairs to win!</p>
                <div id="memoryGrid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 20px;"></div>
            `;
            
            const grid = document.getElementById('memoryGrid');
            gameCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'memory-card';
                cardElement.style.cssText = `
                    width: 60px;
                    height: 60px;
                    background: var(--gradient);
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 2rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                `;
                cardElement.dataset.card = card;
                cardElement.dataset.index = index;
                cardElement.onclick = () => flipCard(cardElement);
                grid.appendChild(cardElement);
            });
            
            function flipCard(cardElement) {
                if (flippedCards.length < 2 && !cardElement.classList.contains('flipped')) {
                    cardElement.classList.add('flipped');
                    cardElement.textContent = cardElement.dataset.card;
                    flippedCards.push(cardElement);
                    
                    if (flippedCards.length === 2) {
                        setTimeout(checkMatch, 1000);
                    }
                }
            }
            
            function checkMatch() {
                if (flippedCards[0].dataset.card === flippedCards[1].dataset.card) {
                    matchedPairs++;
                    createParticles(15);
                    if (matchedPairs === cards.length) {
                        setTimeout(() => {
                            gameContent.innerHTML = '<h3 style="color: var(--primary);">Congratulations! You won! üéâ</h3>';
                        }, 500);
                    }
                } else {
                    flippedCards.forEach(card => {
                        card.classList.remove('flipped');
                        card.textContent = '';
                    });
                }
                flippedCards = [];
            }
            
            document.getElementById('gameArea').style.display = 'block';
        }
        
        function startSongGuess(){
            const gameContent = document.getElementById('gameContent');
            const songs = [
                { lyric: 'But I still got love for you', answers: ['Levitating','Love Song','As It Was','Endless Love'], correct: 3 },
                { lyric: 'I got that sunshine in my pocket', answers: ['Happy','Sugar','Levitating','As It Was'], correct: 2 },
                { lyric: 'We could be together if we tried', answers: ['Closer','Stay','Perfect','Gerua'], correct: 1 }
            ];
            let idx = Math.floor(Math.random()*songs.length);
            const s = songs[idx];
            gameContent.innerHTML = `
                <h3 style="color: var(--primary);">Song Guess</h3>
                <p style="font-size:1.1rem;">Identify the song from this lyric:</p>
                <blockquote style="font-style:italic; margin: 12px 0;">"${s.lyric}"</blockquote>
                <div style="display:grid; gap:8px;">${s.answers.map((a,i)=>`<button class="btn" style="width:100%;" onclick="answerSong(${i},${s.correct})">${a}</button>`).join('')}</div>
                <div id="songResult" style="margin-top:16px; font-size:1.2rem; text-align:center;"></div>
            `;

            window.answerSong = function(selected, correct){ const el = document.getElementById('songResult'); if (selected===correct){ el.textContent = 'Correct! üéâ'; createParticles(20); } else { el.textContent = 'Not quite ‚Äî try another!'; } };
            document.getElementById('gameArea').style.display = 'block';
        }

        function startDateNightPicker(){
            const ideas = [ 'Candlelight dinner at home','Stargazing at the hill','Road trip to nearby town','Cooking a new recipe together','Movie marathon with snacks','Picnic in the park' ];
            const pick = ideas[Math.floor(Math.random()*ideas.length)];
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <h3 style="color: var(--primary);">Date Night Picker</h3>
                <p style="font-size:1.1rem;">Spin the wheel to pick a surprise date idea:</p>
                <div style="margin:18px 0; font-size:1.3rem; font-weight:600;">üéØ ${pick}</div>
                <div style="display:flex; gap:10px; justify-content:center;"><button class="btn" onclick="startDateNightPicker()">Pick Again</button></div>
            `;
            createParticles(12);
            document.getElementById('gameArea').style.display = 'block';
        }
        
        function startFortuneTeller() {
            const fortunes = [
                "2026 will bring you endless happiness and love! üåü",
                "A beautiful journey awaits you both! üí´",
                "Your love will grow stronger with each passing day! üíï",
                "Amazing adventures are coming your way! üöÄ",
                "2026 will be your most magical year yet! ‚ú®"
            ];
            
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <h3 style="color: var(--primary); margin-bottom: 20px;">Fortune Teller üîÆ</h3>
                <p style="font-size: 1.1rem; margin-bottom: 20px;">Click the crystal ball to reveal your fortune for 2026!</p>
                <div style="text-align: center;">
                    <div id="crystalBall" style="width: 100px; height: 100px; background: radial-gradient(circle, #9d00ff, #00ffff); border-radius: 50%; margin: 0 auto; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 3rem; transition: all 0.3s ease;" onclick="revealFortune()">üîÆ</div>
                    <div id="fortune" style="margin-top: 20px; font-size: 1.2rem; min-height: 60px; display: flex; align-items: center; justify-content: center;"></div>
                </div>
            `;
            
            window.revealFortune = function() {
                const ball = document.getElementById('crystalBall');
                const fortuneDiv = document.getElementById('fortune');
                
                ball.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    ball.style.transform = 'scale(1)';
                    const fortune = fortunes[Math.floor(Math.random() * fortunes.length)];
                    fortuneDiv.textContent = fortune;
                    createParticles(30);
                }, 500);
            };
            
            document.getElementById('gameArea').style.display = 'block';
        }
        
        function closeGame() {
            document.getElementById('gameArea').style.display = 'none';
        }
        
        // Photo Gallery Functions
        function handlePhotoUpload(input) {
            const files = input.files;
            const grid = document.getElementById('photoGrid');
            
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const card = document.createElement('div');
                    card.className = 'memory-card';
                    card.style.cursor = 'pointer';
                    card.onclick = () => openLightbox(e.target.result);
                    card.innerHTML = `
                        <img src="${e.target.result}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 15px 15px 0 0;">
                        <h3>Uploaded Memory</h3>
                        <p>${new Date().toLocaleDateString()}</p>
                    `;
                    grid.appendChild(card);
                };
                reader.readAsDataURL(file);
            }
        }
        
        function openLightbox(src) {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightboxImg');
            img.src = src;
            lightbox.style.display = 'flex';
        }
        
        function closeLightbox() {
            document.getElementById('lightbox').style.display = 'none';
        }
        
        // Mood Tracker Functions
        let moodHistory = JSON.parse(localStorage.getItem('moodHistory') || '[]');
        
        function trackMood(mood) {
            const today = new Date().toDateString();
            const existingEntry = moodHistory.find(entry => entry.date === today);
            
            if (existingEntry) {
                existingEntry.mood = mood;
            } else {
                moodHistory.push({ date: today, mood: mood });
            }
            
            localStorage.setItem('moodHistory', JSON.stringify(moodHistory));
            updateMoodDisplay();
            createParticles(20);
            
            // Highlight selected mood
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-mood="${mood}"]`).classList.add('selected');
        }
        
        function updateMoodDisplay() {
            const statsDiv = document.getElementById('moodStats');
            const recentDiv = document.getElementById('recentMoods');
            
            // Calculate mood stats
            const moodCounts = {};
            moodHistory.forEach(entry => {
                moodCounts[entry.mood] = (moodCounts[entry.mood] || 0) + 1;
            });
            
            const totalEntries = moodHistory.length;
            statsDiv.innerHTML = Object.entries(moodCounts).map(([mood, count]) => `
                <div style="text-align: center; padding: 15px; background: rgba(255, 107, 157, 0.1); border-radius: 10px;">
                    <div style="font-size: 2rem; margin-bottom: 5px;">${getMoodEmoji(mood)}</div>
                    <div style="font-weight: bold; color: var(--primary);">${mood.charAt(0).toUpperCase() + mood.slice(1)}</div>
                    <div style="color: #666;">${count} ${count === 1 ? 'day' : 'days'}</div>
                    <div style="font-size: 0.9rem;">${Math.round((count / totalEntries) * 100)}%</div>
                </div>
            `).join('');
            
            // Show recent moods
            const recentMoods = moodHistory.slice(-7).reverse(); // Last 7 days
            recentDiv.innerHTML = recentMoods.map(entry => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
                    <span>${entry.date}</span>
                    <span style="font-size: 1.5rem;">${getMoodEmoji(entry.mood)}</span>
                </div>
            `).join('');
        }
        
        function getMoodEmoji(mood) {
            const emojis = {
                happy: 'üòä',
                loved: 'üíï',
                excited: 'ü§©',
                peaceful: 'üòå',
                grateful: 'üôè',
                tired: 'üò¥'
            };
            return emojis[mood] || 'üòä';
        }
        
        // Handle music upload
        function handleMusicUpload(input) {
            const file = input.files[0];
            if (file) {
                const audio = document.getElementById('customMusic');
                const url = URL.createObjectURL(file);
                audio.src = url;
                audio.play();
                musicPlayer.classList.remove('paused');
                musicText.textContent = `Playing: ${file.name}`;
            }
        }

        // YouTube iframe controls (simple postMessage API)
        function playVideo(id) {
            const iframe = document.getElementById(id);
            if (!iframe) return;
            iframe.contentWindow.postMessage(JSON.stringify({ event: 'command', func: 'playVideo', args: [] }), '*');
        }
        function pauseVideo(id) {
            const iframe = document.getElementById(id);
            if (!iframe) return;
            iframe.contentWindow.postMessage(JSON.stringify({ event: 'command', func: 'pauseVideo', args: [] }), '*');
        }
        
        // Modal functions
        function showModal(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('messageModal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('messageModal').style.display = 'none';
        }
        
        // Particle effect
        function createParticles(count) {
            for(let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.innerHTML = '‚ú®';
                particle.style.cssText = `
                    position: fixed;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    font-size: 1.5rem;
                    pointer-events: none;
                    animation: float 3s ease-out forwards;
                    z-index: 999;
                `;
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 3000);
            }
        }
        
        // ===== Wishes & Vision Board: UI + persistence =====
        async function renderWishes() {
            const listEl = document.getElementById('wishesList');
            if (!listEl) return;
            listEl.innerHTML = '';
            const items = await backend.list('wishes');
            if (!items || items.length === 0) return;
            items.forEach(w => {
                const card = document.createElement('div');
                card.className = 'wish-card';
                card.innerHTML = `
                    <div class="wish-icon">‚ú®</div>
                    <h3>${escapeHtml(w.title)}</h3>
                    <p>${escapeHtml(w.desc || '')}</p>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <button class="btn" onclick="deleteWish('${w.id}')">Delete</button>
                    </div>
                `;
                listEl.appendChild(card);
            });
        }

        // Render coupons from backend
        async function renderCoupons(){
            const grid = document.getElementById('couponGrid');
            if (!grid) return;
            grid.innerHTML = '';
            const items = await backend.list('coupons');
            if (!items || items.length === 0) return;
            items.forEach(it => {
                const el = document.createElement('div');
                el.className = 'coupon';
                el.dataset.id = it.id;
                if (it.redeemed) el.classList.add('redeemed');
                el.onclick = () => redeemCoupon(el);
                el.innerHTML = `<h3>${escapeHtml(it.title)}</h3><p>${escapeHtml(it.desc || '')}</p>`;
                grid.appendChild(el);
            });
        }

        // Render memory jar (list of short memories)
        async function renderMemoryJar(){
            const jar = document.getElementById('memoryJar');
            if (!jar) return;
            jar.innerHTML = '';
            const items = await backend.list('memories');
            if (!items || items.length === 0) return;
            const list = document.createElement('ul');
            list.style.listStyle = 'disc inside';
            items.slice(0,50).forEach(it => {
                const li = document.createElement('li');
                li.textContent = it.title || it.note || '';
                list.appendChild(li);
            });
            jar.appendChild(list);
        }

        // Render letter extras: story chapters and promises
        async function renderLetterExtras(){
            const container = document.getElementById('letterExtras');
            if (!container) return;
            // chapters (static)
            container.innerHTML = `
                <h3 style="color:var(--primary);">Love Story Chapters</h3>
                <h4>Chapter 1: The Beginning (Nov 25, 2023)</h4>
                <p>Friendship transformed into love - realizing they were soulmates</p>
                <h4>Chapter 2: Growing Together (Year One)</h4>
                <p>365 days of building foundation, learning dreams, supporting challenges</p>
                <h4>Chapter 3: Stronger Than Ever (Year Two)</h4>
                <p>365 days of unbreakable bond, planning future, dreaming of marriage</p>
                <h4>Chapter 4: The Next Adventure (Coming Soon)</h4>
                <p>Marriage & forever - moving in together, building dream home, starting family</p>
                <h3 style="color:var(--primary); margin-top:12px;">Sacred Promises</h3>
            `;
            // promises from backend
            const promises = await backend.list('promises');
            if (promises && promises.length) {
                const ul = document.createElement('ul'); ul.style.listStyle = 'disc inside';
                promises.forEach(p => { const li = document.createElement('li'); li.textContent = p.title || ''; ul.appendChild(li); });
                container.appendChild(ul);
            }
        }

        // Poems (Hindi poetry) rendering and persistence
        async function renderPoems(){
            const list = document.getElementById('poemsList');
            if (!list) return;
            // Keep existing decorative lines if poems empty
            const poems = await backend.list('poems');
            if (!poems || poems.length === 0) return;
            list.innerHTML = poems.map(p => `<p style="font-family: 'Caveat', cursive; font-size:1.1rem; color:#ff6b9d; margin-top:10px;">${escapeHtml(p.text)}</p>`).join('');
        }

        async function addPoem(){
            const input = document.getElementById('poemInput');
            if (!input) return;
            const text = (input.value || '').trim();
            if (!text) { showModal('Oops','Please enter a short line or quote.'); return; }
            await backend.put('poems', { text, date: new Date().toISOString() });
            input.value = '';
            await renderPoems();
            createParticles(8);
        }

        async function addWish() {
            const title = (document.getElementById('wishTitle') || {}).value || '';
            const desc = (document.getElementById('wishDesc') || {}).value || '';
            if (!title.trim()) { showModal('Oops','Please enter a wish title.'); return; }
            const item = { title: title.trim(), desc: desc.trim(), date: new Date().toISOString() };
            await backend.put('wishes', item);
            (document.getElementById('wishTitle') || {}).value = '';
            (document.getElementById('wishDesc') || {}).value = '';
            await renderWishes();
            createParticles(12);
        }

        async function deleteWish(id) {
            if (!confirm('Delete this wish?')) return;
            await backend.delete('wishes', id);
            await renderWishes();
        }

        // Vision board functions
        async function renderVisionBoard() {
            const grid = document.getElementById('visionGrid');
            if (!grid) return;
            grid.innerHTML = '';
            const items = await backend.list('memories');
            items.forEach(it => {
                const el = document.createElement('div');
                el.className = 'memory-card';
                el.innerHTML = `
                    ${it.data ? `<img src="${it.data}" style="width:100%; height:140px; object-fit:cover; border-radius:15px 15px 0 0;">` : `<div class="memory-img">üìù</div>`}
                    <h3>${escapeHtml(it.title || it.note || 'Vision')}</h3>
                    <p>${escapeHtml(it.note || '')}</p>
                    <div style="margin-top:8px;"><button class="btn" onclick="deleteVisionItem('${it.id}')">Remove</button></div>
                `;
                grid.appendChild(el);
            });
        }

        function addVisionItemFromFile(input) {
            const file = input.files && input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = async function(e) {
                const data = e.target.result;
                const item = { data, date: new Date().toISOString(), title: 'Image Vision' };
                await backend.put('memories', item);
                await renderVisionBoard();
            };
            reader.readAsDataURL(file);
        }

        async function addVisionText() {
            const text = (document.getElementById('visionText') || {}).value || '';
            if (!text.trim()) { showModal('Oops','Please enter a vision note.'); return; }
            const item = { note: text.trim(), date: new Date().toISOString(), title: text.trim().slice(0,40) };
            await backend.put('memories', item);
            (document.getElementById('visionText') || {}).value = '';
            await renderVisionBoard();
        }

        async function deleteVisionItem(id) {
            if (!confirm('Remove this vision item?')) return;
            await backend.delete('memories', id);
            await renderVisionBoard();
        }

        // small helper to avoid HTML injection in generated content
        function escapeHtml(s) { return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }

        
        
        // Save heart count
        function saveHeartCount() {
            localStorage.setItem('heartCount', heartCount);
        }
        
        // Initialize App
        function initApp() {
            // Ensure only home page is active initially
            pages.forEach(page => { page.classList.remove('active'); page.style.display = 'none'; });
            // If a nav link already has `active` in HTML, open that page; otherwise default to Home
            const preActive = document.querySelector('.nav-link.active');
            const startPage = preActive ? preActive.getAttribute('data-page') : 'home';
            const startEl = document.getElementById(startPage);
            if (startEl) { startEl.classList.add('active'); startEl.style.display = 'block'; }
            
            init3DBackground();
            setupNavigation();
            createFloatingHearts();
            updateCountdown();
            setupMusicPlayer();
            // initialize backend then load saved data
            (async function(){
                try{
                    await backend.init();
                    console.log('backend initialized');
                } catch(e){
                    console.warn('backend initialization failed, continuing with localStorage fallback', e);
                }
                try{ await loadSavedData(); } catch(e){ console.error('loadSavedData failed', e); }
            })();
            updateMoodDisplay();
            
            // Save on unload
            window.addEventListener('beforeunload', saveHeartCount);
        }
        
        document.addEventListener('DOMContentLoaded', initApp);
        
        /* ===== In-Page Backend (IndexedDB with localStorage fallback) ===== */
        const backend = (function(){
            const DB_NAME = 'our_forever_journey_db';
            const DB_VERSION = 1;
            const STORE_NAMES = ['wishes','memories','coupons','hearts','moods','photos','timeline','promises'];
            let db = null;
            const events = new EventTarget();

            function openDB(){
                return new Promise((resolve, reject) => {
                    if (!window.indexedDB) return resolve(null);
                    const req = indexedDB.open(DB_NAME, DB_VERSION);
                    req.onupgradeneeded = (e) => {
                        const idb = e.target.result;
                        STORE_NAMES.forEach(name => { if (!idb.objectStoreNames.contains(name)) idb.createObjectStore(name, { keyPath: 'id' }); });
                    };
                    req.onsuccess = () => { db = req.result; resolve(db); };
                    req.onerror = () => resolve(null);
                });
            }

            function tx(storeName, mode='readonly'){ return db ? db.transaction(storeName, mode).objectStore(storeName) : null; }

            function id() { return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }

            // Fallback storage using localStorage
            function lsGet(key){ try { return JSON.parse(localStorage.getItem(key) || '[]'); } catch { return []; } }
            function lsSet(key, arr){ localStorage.setItem(key, JSON.stringify(arr)); }

            async function init(){
                await openDB();
                // migrate localStorage keys into IndexedDB if empty
                if (db) {
                    for (const name of STORE_NAMES) {
                        const store = tx(name,'readonly');
                        const reqCount = store.count();
                        await new Promise(r => { reqCount.onsuccess = r; reqCount.onerror = r; });
                        if (reqCount.result === 0) {
                            const data = lsGet(name);
                            if (data && data.length) {
                                const w = db.transaction(name,'readwrite').objectStore(name);
                                data.forEach(item => { if (!item.id) item.id = id(); w.put(item); });
                            }
                        }
                    }
                }
                return true;
            }

            function list(storeName){
                if (db) {
                    return new Promise((resolve) => {
                        try {
                            const store = db.transaction(storeName,'readonly').objectStore(storeName);
                            const req = store.getAll();
                            req.onsuccess = () => resolve(req.result || []);
                            req.onerror = () => resolve([]);
                        } catch (e) { resolve([]); }
                    });
                } else {
                    return Promise.resolve(lsGet(storeName));
                }
            }

            function get(storeName, key){
                if (db) {
                    return new Promise((resolve) => {
                        try {
                            const req = db.transaction(storeName,'readonly').objectStore(storeName).get(key);
                            req.onsuccess = () => resolve(req.result || null);
                            req.onerror = () => resolve(null);
                        } catch (e) { resolve(null); }
                    });
                } else {
                    const arr = lsGet(storeName);
                    return Promise.resolve(arr.find(x=>x.id===key) || null);
                }
            }

            function put(storeName, item){
                if (!item.id) item.id = id();
                if (db) {
                    return new Promise((resolve) => {
                        const txn = db.transaction(storeName,'readwrite').objectStore(storeName).put(item);
                        txn.onsuccess = () => { events.dispatchEvent(new CustomEvent('change',{detail:{store:storeName,action:'put',item}})); resolve(item); };
                        txn.onerror = () => resolve(item);
                    });
                } else {
                    const arr = lsGet(storeName); const idx = arr.findIndex(x=>x.id===item.id); if (idx>=0) arr[idx]=item; else arr.push(item); lsSet(storeName,arr); events.dispatchEvent(new CustomEvent('change',{detail:{store:storeName,action:'put',item}})); return Promise.resolve(item);
                }
            }

            function remove(storeName, key){
                if (db) {
                    return new Promise((resolve) => {
                        const txn = db.transaction(storeName,'readwrite').objectStore(storeName).delete(key);
                        txn.onsuccess = () => { events.dispatchEvent(new CustomEvent('change',{detail:{store:storeName,action:'delete',key}})); resolve(true); };
                        txn.onerror = () => resolve(false);
                    });
                } else {
                    const arr = lsGet(storeName); const n = arr.filter(x=>x.id!==key); lsSet(storeName,n); events.dispatchEvent(new CustomEvent('change',{detail:{store:storeName,action:'delete',key}})); return Promise.resolve(true);
                }
            }

            // Convenience APIs
            return {
                init,
                list: (s) => list(s),
                get: (s,k) => get(s,k),
                put: (s,item) => put(s,item),
                delete: (s,k) => remove(s,k),
                onChange: (fn) => { events.addEventListener('change', fn); },
                offChange: (fn) => { events.removeEventListener('change', fn); },
            };
        })();

        // Wire UI load/save to backend
        async function loadSavedData(){
            // load coupons
            const coupons = await backend.list('coupons');
            if (coupons.length === 0) {
                // initial default coupons already in DOM; persist them
                document.querySelectorAll('.coupon').forEach(async (el) => {
                    const title = el.querySelector('h3').textContent;
                    const desc = el.querySelector('p').textContent;
                    await backend.put('coupons',{ id: el.dataset.id || undefined, title, desc, redeemed: el.classList.contains('redeemed') });
                });
            } else {
                // update DOM from backend
                document.querySelectorAll('.coupon').forEach(el => {
                    const title = el.querySelector('h3').textContent;
                    const found = coupons.find(c => c.title === title);
                    if (found && found.redeemed) el.classList.add('redeemed');
                });
            }

            // load hearts
            const hearts = await backend.list('hearts');
            if (hearts.length) {
                const last = hearts[hearts.length-1];
                heartCount = last.count || 0; heartCountEl.textContent = heartCount;
            }

            // load moods
            const moods = await backend.list('moods');
            if (moods.length) { moodHistory = moods.map(m=>({date:m.date,mood:m.mood})); localStorage.setItem('moodHistory', JSON.stringify(moodHistory)); }

            // load photos into gallery
            const photos = await backend.list('photos');
            if (photos.length) {
                const grid = document.getElementById('photoGrid');
                photos.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'memory-card';
                    card.style.cursor = 'pointer';
                    card.onclick = () => openLightbox(p.data);
                    card.innerHTML = `<img src="${p.data}" style="width:100%; height:150px; object-fit:cover; border-radius:15px 15px 0 0;"> <h3>Uploaded Memory</h3> <p>${new Date(p.date).toLocaleDateString()}</p>`;
                    grid.appendChild(card);
                });
            }

            // seed canonical relationship data first (ensures timeline and related stores exist)
            await seedRelationshipData();
            // render wishes, vision board and other views after seeding
            await renderWishes();
            await renderVisionBoard();
            await renderTimeline();
            await renderCoupons();
            await renderMemoryJar();
            await renderLetterExtras();
            await renderPoems();
        }

        // Timeline functions
        async function renderTimeline() {
            const container = document.getElementById('timelineList');
            if (!container) return;
            container.innerHTML = '';
            let items = await backend.list('timeline');
            // If no timeline entries exist, seed defaults (20 meetings)
            if (!items || items.length === 0) {
                const defaults = generateDefaultMeetings();
                for (const d of defaults) { await backend.put('timeline', d); }
                items = await backend.list('timeline');
            }
            // sort by date
            items.sort((a,b) => new Date(a.date || 0) - new Date(b.date || 0));
            items.slice(0,50).forEach(it => {
                const node = document.createElement('div');
                // detect birthday / anniversary keywords to highlight
                const txt = ((it.title||'') + ' ' + (it.note||'')).toLowerCase();
                const isBirthday = /birthday|my birthday|her birthday/.test(txt);
                const isAnniv = /anniversary|anniversery|our 2nd anniversary|anniv/.test(txt);
                node.className = 'timeline-item' + (isBirthday || isAnniv ? ' highlight' : '');
                const badge = isAnniv ? 'üíç' : (isBirthday ? 'üéÇ' : '');
                node.innerHTML = `
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <h3>${escapeHtml(it.title || 'Meeting')} ${badge ? '<span style="margin-left:8px">'+badge+'</span>' : ''}</h3>
                        <p>${escapeHtml(it.note || '')}</p>
                        <div style="margin-top:8px; display:flex; gap:8px; align-items:center; justify-content:flex-end;">
                            <small style="color:#999;">${it.date ? formatDate(it.date) : ''}</small>
                            <button class="btn" style="padding:6px 10px; font-size:0.9rem;" onclick="openEditTimeline('${it.id}')">Edit</button>
                            <button class="btn" style="padding:6px 10px; font-size:0.9rem;" onclick="deleteTimelineEvent('${it.id}')">Delete</button>
                        </div>
                    </div>
                `;
                container.appendChild(node);
            });
            // update count
            const countEl = document.getElementById('timelineCount'); if (countEl) countEl.textContent = String((items && items.length) || 0);
        }

        // Format date as DD-MM-YYYY
        function formatDate(d){
            try{
                const dt = new Date(d);
                const dd = String(dt.getDate()).padStart(2,'0');
                const mm = String(dt.getMonth()+1).padStart(2,'0');
                const yy = dt.getFullYear();
                return `${dd}-${mm}-${yy}`;
            }catch(e){ return d; }
        }

        async function addTimelineEvent(){
            const title = (document.getElementById('eventTitle') || {}).value || '';
            const date = (document.getElementById('eventDate') || {}).value || new Date().toISOString();
            const note = (document.getElementById('eventNote') || {}).value || '';
            if (!title.trim()) { showModal('Oops','Please enter an event title.'); return; }
            const item = { title: title.trim(), date: date, note: note.trim() };
            await backend.put('timeline', item);
            (document.getElementById('eventTitle') || {}).value = '';
            (document.getElementById('eventDate') || {}).value = '';
            (document.getElementById('eventNote') || {}).value = '';
            await renderTimeline();
            createParticles(12);
        }

        async function deleteTimelineEvent(id){
            if (!confirm('Delete this event?')) return;
            await backend.delete('timeline', id);
            await renderTimeline();
        }

        // Backup/Restore/Reset functions for timeline
        async function backupTimeline(){
            const items = await backend.list('timeline');
            const data = JSON.stringify(items, null, 2);
            try{ localStorage.setItem('timeline_backup', data); } catch(e) { console.warn('backup failed', e); }
            // trigger download
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'timeline-backup.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
            showModal('Backup saved','Timeline exported and saved to localStorage as backup.');
        }

        async function restoreTimeline(){
            const raw = localStorage.getItem('timeline_backup');
            if (!raw) { showModal('No backup','No local backup found. Please export first.'); return; }
            if (!confirm('Restore timeline from last backup? This will replace current timeline.')) return;
            let items; try { items = JSON.parse(raw); } catch(e){ showModal('Invalid backup','Backup data corrupted.'); return; }
            // clear existing
            const existing = await backend.list('timeline');
            for (const e of existing) await backend.delete('timeline', e.id);
            for (const it of items) { if (!it.id) it.id = Date.now().toString(36) + Math.random().toString(36).slice(2,6); await backend.put('timeline', it); }
            await renderTimeline();
            showModal('Restored','Timeline restored from backup.');
        }

        async function resetTimeline(){
            if (!confirm('Reset timeline to the canonical 20 events? This will delete current timeline (a backup will be saved).')) return;
            // automatic backup
            const items = await backend.list('timeline');
            try{ localStorage.setItem('timeline_backup', JSON.stringify(items)); } catch(e) { /* ignore */ }
            // delete all
            for (const e of items) await backend.delete('timeline', e.id);
            // reseed
            await seedRelationshipData();
            await renderTimeline();
            showModal('Reset complete','Timeline reset to canonical events.');
        }

        // simple edit flow (prompt-based)
        async function openEditTimeline(id){
            const it = await backend.get('timeline', id);
            if (!it) return showModal('Not found','Event not found.');
            const newTitle = prompt('Edit title', it.title || '') || it.title;
            const newDate = prompt('Edit date (YYYY-MM-DD)', (it.date||'').slice(0,10)) || (it.date||'');
            const newNote = prompt('Edit note', it.note || '') || it.note;
            if (!newTitle.trim()) return showModal('Invalid','Title cannot be empty.');
            it.title = newTitle.trim(); it.date = newDate; it.note = newNote.trim();
            await backend.put('timeline', it);
            await renderTimeline();
            showModal('Saved','Event updated.');
        }

        function generateDefaultMeetings(){
            // reference-inspired defaults from OLD.HTML with friendly descriptions
                const meetings = [
                    { title: 'First meeting after becoming a couple', date: '2024-01-17', note: 'First meeting after becoming a couple' },
                    { title: 'Spring of our love', date: '2024-03-30', note: 'Spring of our love' },
                    { title: 'Summer memories', date: '2024-08-30', note: 'Summer memories' },
                    { title: 'Autumn embrace', date: '2024-09-24', note: 'Autumn embrace' },
                    { title: 'End of September magic', date: '2024-09-30', note: 'End of September magic' },
                    { title: 'MY birthday celebration', date: '2024-11-08', note: 'MY birthday celebration' },
                    { title: 'Year-end celebration', date: '2024-12-30', note: 'Year-end celebration' },
                    { title: "Pre-Valentine's love", date: '2025-02-11', note: "Pre-Valentine's love" },
                    { title: 'Spring returns', date: '2025-03-11', note: 'Spring returns' },
                    { title: 'Mid-April bliss', date: '2025-04-19', note: 'Mid-April bliss' },
                    { title: 'Spring continues', date: '2025-04-22', note: 'Spring continues' },
                    { title: 'Mere Bhot Pyre Babu birthday celebration', date: '2025-05-13', note: 'Mere Bhot Pyre Babu birthday celebration' },
                    { title: 'Late May warmth', date: '2025-05-23', note: 'Late May warmth' },
                    { title: 'Summer celebrations', date: '2025-07-02', note: 'Summer celebrations' },
                    { title: 'Summer peak love', date: '2025-07-28', note: 'Summer peak love' },
                    { title: 'Late August magic', date: '2025-08-25', note: 'Late August magic' },
                    { title: 'Fall begins with you', date: '2025-09-25', note: 'Fall begins with you' },
                    { title: 'MY birthday again', date: '2025-11-08', note: 'MY birthday again' },
                    { title: 'Our 2nd anniversary', date: '2025-11-25', note: 'Our 2nd anniversary' },
                    { title: '22 Dec 2025', date: '2025-12-22', note: '22 Dec 2025' }
                ];
            // assign ids and return
            return meetings.map((b, idx) => ({ id: (Date.now() + idx).toString(36) + Math.random().toString(36).slice(2,6), ...b }));
        }

        // Seed relationship data (timeline, coupons, promises, memories)
        async function seedRelationshipData(){
            // Remove any existing timeline entries (prevent duplicates) and reseed canonical events
                const existing = await backend.list('timeline');
                if (existing && existing.length) {
                    for (const e of existing) { await backend.delete('timeline', e.id); }
                }
                const meetings = [
                    { title: 'First meeting after becoming a couple', date: '2024-01-17', note: 'First meeting after becoming a couple' },
                    { title: 'Spring of our love', date: '2024-03-30', note: 'Spring of our love' },
                    { title: 'Summer memories', date: '2024-08-30', note: 'Summer memories' },
                    { title: 'Autumn embrace', date: '2024-09-24', note: 'Autumn embrace' },
                    { title: 'End of September magic', date: '2024-09-30', note: 'End of September magic' },
                    { title: "MY birthday celebration", date: '2024-11-08', note: 'MY birthday celebration' },
                    { title: 'Year-end celebration', date: '2024-12-30', note: 'Year-end celebration' },
                    { title: "Pre-Valentine's love", date: '2025-02-11', note: "Pre-Valentine's love" },
                    { title: 'Spring returns', date: '2025-03-11', note: 'Spring returns' },
                    { title: 'Mid-April bliss', date: '2025-04-19', note: 'Mid-April bliss' },
                    { title: 'Spring continues', date: '2025-04-22', note: 'Spring continues' },
                    { title: 'Mere Bhot Pyre Babu birthday celebration', date: '2025-05-13', note: 'Mere Bhot Pyre Babu birthday celebration' },
                    { title: 'Late May warmth', date: '2025-05-23', note: 'Late May warmth' },
                    { title: 'Summer celebrations', date: '2025-07-02', note: 'Summer celebrations' },
                    { title: 'Summer peak love', date: '2025-07-28', note: 'Summer peak love' },
                    { title: 'Late August magic', date: '2025-08-25', note: 'Late August magic' },
                    { title: 'Fall begins with you', date: '2025-09-25', note: 'Fall begins with you' },
                    { title: 'MY birthday again', date: '2025-11-08', note: 'MY birthday again' },
                    { title: 'Our 2nd anniversary', date: '2025-11-25', note: 'Our 2nd anniversary' },
                    { title: '22 Dec 2025', date: '2025-12-22', note: '22 Dec 2025' }
                ];
                for (const m of meetings) await backend.put('timeline', m);
                await renderTimeline();

            // Seed coupons
            const coupons = await backend.list('coupons');
            if (!coupons || coupons.length === 0) {
                const seedCoupons = [
                    { title: 'One Free Breakfast in Bed', desc: 'Valid forever' },
                    { title: '1000 Kisses On Demand', desc: 'Redeemable anytime' },
                    { title: 'Movie Marathon of Your Choice', desc: 'Popcorn included' },
                    { title: 'One Dream Date Night', desc: 'Anywhere' }
                ];
                for (const c of seedCoupons) await backend.put('coupons', c);
                // render coupons after seeding
                renderCoupons();
            }

            // Seed promises
            const promises = await backend.list('promises');
            if (!promises || promises.length === 0) {
                const p = [
                    'To love unconditionally and support dreams',
                    'To be strength in weakness',
                    'To walk beside to marriage and beyond',
                    'To cherish, respect, and love more deeply each day',
                    'To build dream home together',
                    'To make her his wife',
                    'To grow old together hand in hand'
                ];
                for (const t of p) await backend.put('promises', { title: t });
            }

            // Seed memory-jar items
            const memories = await backend.list('memories');
            if (!memories || memories.length === 0) {
                const mems = [
                    'Our first "I love you"', 'Late night video calls', 'Planning our future together', 'Your beautiful smile', 'Our inside jokes', 'Supporting each other\'s dreams', 'Virtual movie nights', 'Morning good wishes'
                ];
                for (const m of mems) await backend.put('memories', { title: m, note: m });
            }
        }

        // update backend when redeeming
        const _origRedeem = redeemCoupon;
        redeemCoupon = async function(element){
            _origRedeem(element);
            const title = element.querySelector('h3').textContent;
            const desc = element.querySelector('p').textContent;
            await backend.put('coupons',{ title, desc, redeemed: element.classList.contains('redeemed') });
        };

        // update backend when sending love
        const _origSendLove = sendLove;
        sendLove = async function(){
            _origSendLove();
            await backend.put('hearts',{ id: Date.now().toString(), count: heartCount, date: new Date().toISOString() });
        };

        // update backend when tracking mood
        const _origTrackMood = trackMood;
        trackMood = async function(mood){
            _origTrackMood(mood);
            const today = new Date().toDateString();
            await backend.put('moods',{ id: today, date: today, mood });
        };

        // update backend on photo upload
        const _origHandlePhotoUpload = handlePhotoUpload;
        handlePhotoUpload = async function(input){
            const files = input.files;
            const grid = document.getElementById('photoGrid');
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const data = e.target.result;
                    const p = { id: Date.now().toString(36), data, date: new Date().toISOString() };
                    await backend.put('photos', p);
                    const card = document.createElement('div');
                    card.className = 'memory-card';
                    card.style.cursor = 'pointer';
                    card.onclick = () => openLightbox(data);
                    card.innerHTML = `<img src="${data}" style="width:100%; height:150px; object-fit:cover; border-radius:15px 15px 0 0;"> <h3>Uploaded Memory</h3> <p>${new Date().toLocaleDateString()}</p>`;
                    grid.appendChild(card);
                };
                reader.readAsDataURL(file);
            }
        };

    </script>
</body>
</html>
